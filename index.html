<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./style.css">
<body>
    <div id="bki-wrapper">
        <div id="bki-head">
        <h1 class="bki-headline">Buron Bot</h1>
        </div>
        <div id="bki-container">
          <div id="bki-more">
            <h2>FAQ</h2>
            <div id="faq-options">
              <div class="faq-options-item">Wo finde ich das Fundbüro?</div>
              <div class="faq-options-item">Was mache ich mit gefundenen Gegenständen?</div>
              <div class="faq-options-item gesponsort">Wer ist Alexander Uhrle?</div>
              <div class="faq-options-item gesponsort">In welcher Partei ist Pascal Hübner?</div>
              <div class="faq-options-item">Wo finde ich das Fundbüro?</div>
            </div>
            
          </div>
          <div id="bki-chat">
            <h2>Chat</h2>
            <div id="bki-chat-area">
            </div>
            <input id="bki-input" type="text" placeholder="Ihre Frage..." aria-label="Ihre Frage eingeben"/>
            <div  id="send" tabindex="0" role="button" aria-label="Frage senden">
                <svg fill="currentColor" viewBox="0 0 24 24" color="inherit" class="w-6 h-6"><path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"></path></svg></div>
          </div>
        </div>
        <p class="credits">powered by Itletics - Alex Urhle &  Pascal Hübner</p>
      </div>
      <script src="./config.js"></script>
      <script>
        const bkiArea = document.querySelector('#bki-chat-area');
        let answerCount = 0;
        const node = document.getElementById("bki-input");

        document.getElementById('send').addEventListener('click', async () => {
          const question = document.getElementById('bki-input').value;
          bkiArea.insertAdjacentHTML('beforeEnd','<div class="bki-user-input">'+question+'</div>');
            bkiArea.insertAdjacentHTML('beforeEnd','<div id="bki-a'+answerCount+'" class="bki-ki-answer waiting"><span class="dots"></span><span class="dots"></span><span class="dots"></span></div>');
            document.getElementById('bki-input').value = "";
          const response = await fetch(`${config.apiBaseUrl}/ask`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ question }),
          });
        
          if (response.ok) {
            const data = await response.json();
            document.querySelector('#bki-a'+answerCount+'').classList.remove('waiting');
            document.querySelector('#bki-a'+answerCount+'').innerHTML = data.answer;
            answerCount += 1;
          } else {
            console.error('Error asking question');
          }
        });

        node.addEventListener("keyup", function(event) {
        if (event.key === "Enter") {
            if(document.getElementById('bki-input').value !== ""){
              document.getElementById('send').click();
            }
        }
        });
        </script>
</body>
</html>
